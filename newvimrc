" vim:set ts=2 sts=2 sw=2 expandtab:

autocmd!

call pathogen#incubate()

set nocompatible
" allow unsaved background buffers and remember marks/undo for them
set hidden
" remember more commands and search history
set history=10000
" Don't set a byte-order mark as it can mess with some editors
set nobomb
" Set permanent UTF-8 file encoding
setglobal fileencoding=utf-8
" Set encoding to UTF-8
set encoding=utf-8
" Set terminal encoding to UTF-8
set termencoding=utf-8
" Align '<<' and '>>' to a rounded multiple of 'shiftwidth'
set shiftround
set expandtab
set tabstop=4
set shiftwidth=4
set softtabstop=4
set autoindent
set laststatus=2
set showmatch
" Number of tenths of a second to show paren match
set matchtime=3
set incsearch
set hlsearch
" make searches case-sensitive only if they contain upper-case characters
set ignorecase smartcase
" highlight current line
set cursorline
" highlight current column
set cursorcolumn
set cmdheight=1
set switchbuf=useopen
set showtabline=2
set winwidth=79
" this makes RVM work inside vim. I have no idea why.
set shell=bash
" Prevent Vim from clobbering the scrollback buffer. See
" http://www.shallowsky.com/linux/noaltscreen.html
set t_ti= t_te=
" keep more context when scrolling off the end of a buffer or line
set scrolloff=3
set sidescrolloff=3
" Don't make backups at all
set nobackup
set nowritebackup
set backupdir=~/.vim-tmp,~/.tmp,~/tmp,/var/tmp,/tmp
set directory=~/.vim-tmp,~/.tmp,~/tmp,/var/tmp,/tmp
" allow backspacing over everything in insert mode
set backspace=indent,eol,start
" display incomplete commands
set showcmd
" Enable syntax highlighting
syntax on
" Enable file detection.
" Use the default filetype settings, so that mail gets 'tw' set to 72,
" 'cindent' is on in C files, etc.
" Also load indent files, to automatically do language-dependent indenting.
filetype plugin indent on
" use emacs-style tab completion when selecting files, etc
set wildmode=longest,list
" make tab completion for files/buffers act like bash
set wildmenu
" Set personal leader key to ','
let mapleader=","
let g:mapleader=","
let maplocalleader="\\"
" Fix slow O inserts
:set timeout timeoutlen=1000 ttimeoutlen=100
" set notimeout
" set ttimeout
" set ttimeoutlen=10
" Normally, Vim messes with iskeyword when you open a shell file. This can
" leak out, polluting other file types even after a 'set ft=' change. This
" variable prevents the iskeyword change so it can't hurt anyone.
let g:sh_noisk=1
" None of these are valid word dividers, so make them not be
set isk+=_,$,@,%,#,-,?,&
" Modelines (comments that set vim options on a per-file basis)
set modeline
set modelines=3
" Turn folding off for real, hopefully
set foldmethod=manual
set nofoldenable
" Insert only one space when joining lines that contain sentence-terminating
" punctuation like '.'.
set nojoinspaces
" If a file is changed outside of vim, automatically reload it without asking
set autoread
" Indent comments
set cindent
" See 'cinkeys'; this stops '#' from indenting
set cinkeys=0{,0},:,!^F,o,O,e
" Allow backspace to delete previous characters
set bs=2
" Allows left/right keys to wrap across lines
set whichwrap=<,>,[,],h,l
" Enable line numbering, taking up to 6 characters
set number
" Don't number a word-wrapped line
set cpoptions-=n
" Add angle brackets to pair-matching
set matchpairs+=<:>
" Turn off line-wrapping
set nowrap
" Set default file format for new files
set fileformat=unix
" Support all three newline formats
set fileformats=unix,dos,mac
" Show title in xterm
set title
set noswapfile
set swapsync=fsync
" Don't redraw while executing macros
set lazyredraw
set complete=.,w,b,u,t,i,d
set completeopt=longest,menuone,preview
set ttyfast
set diffopt=filler,iwhite
set nostartofline
" Disable annoying sound on errors
set noerrorbells
set novisualbell
set t_vb=
set tm=500
" Shorten command-line text and other info tokens (see :help shortmess)
set shortmess=atI
" Show Vim mode
set showmode
set showcmd
" Use same symbols as TextMate for tabstops and EOLs
set listchars=tab:▸\ ,eol:¬,trail:☠
" Hide buffer when not in window (to prevent relogin with FTP edit)
set bufhidden
set suffixes=.bak,~,.swp,.o,.info,.aux,.log,.dvi,.bbl,.blg,.brf,.cb,.ind,.idx,.ilg,.inx,.out,.toc
set dictionary=/usr/share/dict/words
set spellfile=~/.vim/custom-dictionary.utf-8.add
set synmaxcol=800

" Enable plugins
filetype plugin on

" Cursorline {{{
"   Only show cursorline in the current window and in normal mode.
augroup cline
    au!
    au WinLeave,InsertEnter * set nocursorline nocursorcolumn
    au WinEnter,InsertLeave * set cursorline cursorcolumn
augroup END
" }}}

" Save when losing focus
au FocusLost * :silent! wall

" Resize splits when the window is resized
au VimResized * :wincmd =

" Highlight trailing whitespace
highlight WhitespaceEOL ctermbg=DarkYellow guibg=DarkYellow
match WhitespaceEOL /\s\+$/

" Remove windows ^M - when the encodings get messed up
noremap <leader>m mmHmt:%s/<C-V><cr>//ge<cr>'tzt'm

" Set format options
" t - autowrap textwidth
" c - autowrap comments to textwidth
" r - autoinsert comment leader with <Enter>
" q - allow formatting of comments with :gq
" l - don't format already long lines
set formatoptions=t,c,r,o,q,l

" Syntax highlighting
if version >= 600
    " Vim 6+
    " Increase highlighting accuracy
    syn sync fromstart
else
    syn sync minlines=1000
endif

if version >= 720
    set relativenumber
endif

" Shortcut to indent entire file
nmap <F11> 1G=G
imap <F11> <ESC>1G=Ga

" Delete = Backspace
nmap <Del> <BS>
imap <Del> <BS>

" Rapidly toggle 'set list'
nmap <leader>l :set list!<CR>

" Shortcut to LustyJuggler
nmap <leader>L :LustyJuggler<CR>

" Search forward (*) and backward (#) for current selection in visual mode
vnoremap <silent> * :call VisualSelection('f')<CR>
vnoremap <silent> # :call VisualSelection('b')<CR>

" Map <space> to / (search) and <ctrl><space> to ? (rev. search) in normal mode
map <space> /
map <c-space> ?

" Change CWD to the directory of the open buffer
map <leader>cd :cd %:p:h<CR>:pwd<CR>

" Return to last edit position when opening a file
autocmd BufReadPost *
    \ if line("'\"") > 0 && line("'\"") <= line("$") |
    \   exe "normal! g`\"" |
    \ endif

" Remember info about open buffers on close
set viminfo^=%
